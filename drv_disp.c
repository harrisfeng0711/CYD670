//==============================================//
//			INCLUDE HEAER FILE					//
//==============================================//
#include "system.h"

//==============================================
//	查表資料
//==============================================
const U8 tabSeg [] = 		 // 共陰
{ 	 		//   .gfa bdec	
	0x3F,   //0b 0011 1111,    // '0'
	0x09,   //0b 0000 1001,    // '1'
	0x5E,   //0b 0101 1110,    // '2'
	0x5D,   //0b 0101 1101,    // '3'
	0x69,   //0b 0110 1001,    // '4'
	0x75,   //0b 0111 0101,    // '5'
	0x77,   //0b 0111 0111,    // '6'
	0x19,   //0b 0001 1001,    // '7'
	0x7F,   //0b 0111 1111,    // '8'
	0x7D,	//0b 0111 1101,    // '9'
	0x00,	//0b 0000 0000,    // ' ' 10
	0x01,	//0b 0000 0001,    // '-' 11 for 188顯示負號
	0x36,	//0b 0011 0110,    // 'C' 12
	0x4F,	//0b 0100 1111,    // 'D' 13
	0x76,	//0b 0111 0110,    // 'E' 14
	0x72,	//0b 0111 0010,    // 'F' 15
	0x7A,	//0b 0111 1010,    // 'P' 16	
	0x6B,	//0b 0110 1011,    // 'H' 17
	0x43	//0b 0100 0011	   // 'n' 18
};



//==============================================//
//				暫存器定義						//
//==============================================//
U8 bSeg0 = 0x0;
U8 bSeg1 = 0x0;
U8 bSeg2 = 0x0;
ubyte bLed = {0x0};
U8 bScanCnt = 0;


//==============================================//
//				函式原型宣告					//
//==============================================//
void pConDisp (U16 dat,U8 dot);
void pScanDisp (void);
void pClrDisp (void);


//==============================================//
//				display scan					//
//==============================================//
void pConDisp (U16 dat,U8 dot)
{
	U8 s0,s1,s2;
	
	s0=dat%10;
	dat/=10;
	s1=dat%10;
	s2=dat/10;
	
	bSeg0 = ~tabSeg[s0];
	bSeg1 = ~tabSeg[s1];
	bSeg2 = ~tabSeg[s2];
	
	if (dot==1)
		bSeg1 &= 0x7F;	// 小數點
	
}
//==============================================//
//				display scan					//
//==============================================//
void pScanDisp (void)
{
	// 掃瞄按鍵前已關閉 S0~S3
	switch (bScanCnt)
	{
		case 0:
			PORTC = bLed.byte;
			oS0 = 0;
			break;
		case 1:
			PORTC = bSeg1;
			oS1 = 0;
			break;
		case 2:
			PORTC = bSeg2;
			oS2 = 0;
			break;
		case 3:
			PORTC = bSeg0;
			oS3 = 0;
			break;
	}
	
	if (++bScanCnt > 3)
		bScanCnt = 0;
}

//==============================================//
// clear display 
//==============================================//
void pClrDisp (void)
{
	bSeg0 = ~tabSeg[dNull];
	bSeg1 = ~tabSeg[dNull];
	bSeg2 = ~tabSeg[dNull];
	bLed.byte = 0xff;
}

	